<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Eurojackpot • Ultra Cyber Tool v3.0</title>

  <!-- Frameworks & Libs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

  <style>
    body {
      background: radial-gradient(70rem 70rem at -10% -10%, rgba(124,92,255,.18), transparent 60%),
                  radial-gradient(50rem 50rem at 110% -10%, rgba(57,255,215,.12), transparent 60%),
                  #040815;
      color: #eef6ff;
      min-height: 100vh;
      font-family: 'Inter', sans-serif;
    }
    .glass {
      background: rgba(11,16,32,0.7);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(140,170,255,.16);
      border-radius: 1rem;
      padding: 1rem;
      box-shadow: 0 20px 60px rgba(0,0,0,.45);
    }
    .chip {
      display:inline-flex; align-items:center; justify-content:center;
      min-width:24px; height:24px; border-radius:6px;
      background:linear-gradient(180deg,#111a33,#182242);
      margin:2px; font-weight:700; font-size:0.75rem; color:#d7e6ff;
      border:1px solid rgba(140,170,255,.18);
      transition: all 0.2s ease;
    }
    .chip:hover { transform:scale(1.15); box-shadow:0 0 12px #39ffd7; }
    .btn-glow {
      transition:all 0.25s ease;
    }
    .btn-glow:hover {
      box-shadow:0 0 12px #7c5cff, 0 0 24px #39ffd7;
    }
  </style>
</head>
<body class="p-4">

  <!-- Header -->
  <div class="text-center mb-6 animate__animated animate__fadeInDown">
    <h1 class="text-3xl font-extrabold text-cyan-300 drop-shadow-lg">Eurojackpot • Ultra Cyber Tool v3.0</h1>
    <p class="text-indigo-200">Archiv • Generieren • Analyse • Favoriten</p>
  </div>

  <!-- Tabs Navigation -->
  <div class="flex justify-center mb-6 space-x-4">
    <button onclick="showTab('tab-archiv')" class="btn-glow px-4 py-2 bg-indigo-600 rounded-lg">📂 Archiv</button>
    <button onclick="showTab('tab-generate')" class="btn-glow px-4 py-2 bg-green-600 rounded-lg">⚡ Generieren</button>
    <button onclick="showTab('tab-analyse')" class="btn-glow px-4 py-2 bg-yellow-600 rounded-lg">📊 Analyse</button>
    <button onclick="showTab('tab-favs')" class="btn-glow px-4 py-2 bg-pink-600 rounded-lg">⭐ Favoriten</button>
  </div>

  <!-- Archiv -->
  <div id="tab-archiv" class="glass animate__animated animate__fadeIn">
    <h2 class="text-xl font-bold mb-2">📂 Archiv</h2>
    <p id="statusText" class="text-sm text-gray-300 mb-2">Noch kein Archiv geladen.</p>
    <div class="flex flex-wrap gap-2 mb-2">
      <input type="file" id="zipInput" accept=".zip,.txt,.csv" class="bg-gray-800 p-2 rounded">
      <button id="loadLatestBtn" class="btn-glow px-3 py-2 bg-blue-600 rounded">📥 Neueste laden</button>
    </div>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-center">
      <div><div class="text-sm text-gray-400">Ziehungen</div><div id="kpiCount" class="font-bold">–</div></div>
      <div><div class="text-sm text-gray-400">Von</div><div id="kpiFrom" class="font-bold">–</div></div>
      <div><div class="text-sm text-gray-400">Bis</div><div id="kpiTo" class="font-bold">–</div></div>
      <div><div class="text-sm text-gray-400">Aktualität</div><div id="kpiFresh" class="font-bold">–</div></div>
    </div>
  </div>

  <!-- Generieren -->
  <div id="tab-generate" class="glass hidden animate__animated animate__fadeIn">
    <h2 class="text-xl font-bold mb-2">⚡ Generieren</h2>
    <div class="mb-2">
      <label class="text-sm text-gray-300">Modus</label>
      <select id="modus" class="bg-gray-800 p-2 rounded w-full">
        <option value="never">Nie gezogene</option>
        <option value="last100">Letzte 100 – Frequenzmuster</option>
        <option value="hot">Hot Paare & Triples</option>
        <option value="groups">5er-Gruppen + Wünsche</option>
        <option value="complex">Komplex (Simulated Annealing)</option>
        <option value="runs">Folgen-Zahlen</option>
      </select>
    </div>
    <div class="mb-2">
      <label class="text-sm text-gray-300">Anzahl Kombinationen</label>
      <input type="number" id="kombis" value="5" min="1" max="25" class="bg-gray-800 p-2 rounded w-full">
    </div>
    <button id="generateBtn" class="btn-glow w-full px-3 py-2 bg-green-600 rounded">⚡ Generieren</button>
    <pre id="liveOutput" class="bg-black p-3 mt-3 rounded h-40 overflow-auto text-green-300 font-mono text-xs"></pre>
    <div id="cards" class="mt-3"></div>
  </div>

  <!-- Analyse -->
  <div id="tab-analyse" class="glass hidden animate__animated animate__fadeIn">
    <h2 class="text-xl font-bold mb-2">📊 Analyse</h2>
    <canvas id="chartMain" class="w-full h-64 mb-4"></canvas>
    <canvas id="chartEuro" class="w-full h-64"></canvas>
    <div id="analysisBox" class="mt-4 text-sm"></div>
  </div>

  <!-- Favoriten -->
  <div id="tab-favs" class="glass hidden animate__animated animate__fadeIn">
    <h2 class="text-xl font-bold mb-2">⭐ Favoriten</h2>
    <input id="favSearch" placeholder="Suche Favoriten…" class="bg-gray-800 p-2 rounded w-full mb-2">
    <div id="favoritesBox"></div>
    <div class="flex gap-2 mt-3">
      <button id="exportFavs" class="btn-glow flex-1 px-3 py-2 bg-indigo-600 rounded">⬇️ Export</button>
      <button id="importFavs" class="btn-glow flex-1 px-3 py-2 bg-indigo-600 rounded">⬆️ Import</button>
    </div>
  </div>

  <script>
    // --- State ---
    let draws=[], generated=[], favorites=JSON.parse(localStorage.getItem("favs")||"[]");

    // --- Tabs ---
    function showTab(id){
      document.querySelectorAll('[id^="tab-"]').forEach(el=>el.classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
    }

    // --- Archiv Handling ---
    document.getElementById("zipInput").addEventListener("change", handleFile);
    async function handleFile(evt){
      const file = evt.target.files?.[0]; if(!file) return;
      let text="";
      if(file.name.endsWith(".zip")){
        const zip = await JSZip.loadAsync(file);
        const entry = Object.values(zip.files)[0];
        text = await entry.async("string");
      }else{
        text = await file.text();
      }
      parseArchive(text);
    }
    document.getElementById("loadLatestBtn").addEventListener("click", async()=>{
      const res = await fetch("https://www.lotto-bayern.de/static/gamebroker_2/de/download_files/archiv_eurojackpot.zip");
      const blob = await res.blob();
      const zip = await JSZip.loadAsync(blob);
      const entry = Object.values(zip.files)[0];
      const text = await entry.async("string");
      parseArchive(text);
    });
    function parseArchive(txt){
      localStorage.setItem("archive", txt);
      const lines=txt.split(/\r?\n/).filter(Boolean);
      draws=[];
      for(const l of lines){
        const nums=l.split(/\s|;|,/).map(n=>+n).filter(Boolean);
        if(nums.length>=7){
          draws.push({main:nums.slice(0,5).sort((a,b)=>a-b), euro:nums.slice(5,7).sort((a,b)=>a-b)});
        }
      }
      document.getElementById("statusText").textContent="Archiv geladen ✔";
      document.getElementById("kpiCount").textContent=draws.length;
      renderCharts();
    }
    // auto-load
    if(localStorage.getItem("archive")) parseArchive(localStorage.getItem("archive"));

    // --- Charts ---
    let chartMain, chartEuro;
    function renderCharts(){
      const freqMain=Array(51).fill(0), freqEuro=Array(13).fill(0);
      draws.forEach(d=>{ d.main.forEach(n=>freqMain[n]++); d.euro.forEach(e=>freqEuro[e]++); });
      if(chartMain) chartMain.destroy();
      if(chartEuro) chartEuro.destroy();
      chartMain=new Chart(document.getElementById("chartMain"),{type:"bar",data:{labels:[...Array(50).keys()].slice(1),datasets:[{data:freqMain.slice(1),backgroundColor:"#39ffd7"}]}});
      chartEuro=new Chart(document.getElementById("chartEuro"),{type:"bar",data:{labels:[...Array(12).keys()].slice(1),datasets:[{data:freqEuro.slice(1),backgroundColor:"#7c5cff"}]}});
    }

    // --- Generator (Dummy Demo) ---
    document.getElementById("generateBtn").addEventListener("click",()=>{
      const n=+document.getElementById("kombis").value||1;
      generated=[];
      for(let i=0;i<n;i++){
        const main=Array.from({length:50},(_,i)=>i+1).sort(()=>Math.random()-0.5).slice(0,5).sort((a,b)=>a-b);
        const euro=Array.from({length:12},(_,i)=>i+1).sort(()=>Math.random()-0.5).slice(0,2).sort((a,b)=>a-b);
        generated.push({main,euro});
      }
      renderResults();
    });
    function renderResults(){
      const out=document.getElementById("liveOutput"); out.textContent="";
      const cards=document.getElementById("cards"); cards.innerHTML="";
      generated.forEach((tip,i)=>{
        out.textContent+="#"+(i+1)+": "+tip.main.join("-")+" | E:"+tip.euro.join("-")+"\n";
        const div=document.createElement("div");
        div.className="glass p-2 mb-2 animate__animated animate__fadeInUp";
        div.innerHTML="<div class='flex justify-between'><div>"+tip.main.join(" ")+" | <span class='text-pink-400'>"+tip.euro.join(" ")+"</span></div><button class='btn-glow bg-pink-600 px-2 rounded' onclick='addFav("+i+")'>⭐</button></div>";
        cards.appendChild(div);
      });
    }

    // --- Favoriten ---
    function addFav(i){
      favorites.push(generated[i]);
      localStorage.setItem("favs",JSON.stringify(favorites));
      renderFavs();
    }
    function renderFavs(){
      const box=document.getElementById("favoritesBox"); box.innerHTML="";
      const search=document.getElementById("favSearch").value.toLowerCase();
      favorites.filter(f=>f.main.join(" ").includes(search)).forEach((f,idx)=>{
        const div=document.createElement("div");
        div.className="glass p-2 mb-2 flex justify-between items-center";
        div.innerHTML="<div>"+f.main.join(" ")+" | <span class='text-pink-400'>"+f.euro.join(" ")+"</span></div><button class='bg-red-600 px-2 rounded' onclick='delFav("+idx+")'>✖</button>";
        box.appendChild(div);
      });
    }
    function delFav(idx){
      favorites.splice(idx,1); localStorage.setItem("favs",JSON.stringify(favorites)); renderFavs();
    }
    document.getElementById("favSearch").addEventListener("input",renderFavs);
    document.getElementById("exportFavs").addEventListener("click",()=>{
      const blob=new Blob([JSON.stringify(favorites)],{type:"application/json"});
      const url=URL.createObjectURL(blob);
      const a=document.createElement("a"); a.href=url; a.download="favoriten.json"; a.click();
      URL.revokeObjectURL(url);
    });
    document.getElementById("importFavs").addEventListener("click",()=>{
      const inp=document.createElement("input"); inp.type="file"; inp.accept=".json";
      inp.onchange=async e=>{ const file=e.target.files[0]; const txt=await file.text(); favorites=JSON.parse(txt); localStorage.setItem("favs",txt); renderFavs(); };
      inp.click();
    });
    renderFavs();
  </script>
</body>
</html>