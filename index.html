<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Eurojackpot ‚Ä¢ Ultra Cyber Tool v2.1</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<style>
  :root{
    --bg:#040815; --panel:#0b1020; --panel2:#0a0f1e;
    --text:#eef6ff; --muted:#8fb0d6;
    --brand:#39ffd7; --accent:#7c5cff; --ok:#39ff90; --warn:#ff6b6b; --info:#5ad1ff;
    --chip:#111a33; --chip2:#182242;
    --chipE:#1b243d; --chipE2:#122235;
    --g1:linear-gradient(90deg,#6ea8ff 0%, #3057ff 100%);
    --g2:linear-gradient(90deg,#58ffb6 0%, #09a66f 100%);
    --g3:linear-gradient(90deg,#c88bff 0%, #6b35ff 100%);
    --g4:linear-gradient(90deg,#ffcc66 0%, #c57300 100%);
    --g5:linear-gradient(90deg,#ff7b7b 0%, #c11d1d 100%);
    --e1:linear-gradient(90deg,#ffe066 0%, #9c7a00 100%);
    --e2:linear-gradient(90deg,#5bffe1 0%, #0aa3a3 100%);
  }
  html,body{
    background:
      radial-gradient(70rem 70rem at -10% -10%, rgba(124,92,255,.18), transparent 60%),
      radial-gradient(50rem 50rem at 110% -10%, rgba(57,255,215,.12), transparent 60%),
      radial-gradient(60rem 60rem at 120% 120%, rgba(0,204,255,.10), transparent 60%),
      var(--bg);
    color:var(--text);
    min-height:100%;
  }
  body:before{
    content:""; position:fixed; inset:0; pointer-events:none; z-index:0;
    background:repeating-linear-gradient(0deg, rgba(255,255,255,.02) 0, rgba(255,255,255,.02) 1px, transparent 1px, transparent 3px);
    mix-blend-mode:overlay; opacity:.45;
  }
  .cardx{ position:relative; background:linear-gradient(180deg,rgba(11,16,32,.85),rgba(10,16,30,.75));
    border:1px solid rgba(140,170,255,.16); border-radius:18px; padding:12px;
    box-shadow:0 18px 60px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.05);
    backdrop-filter: blur(10px); overflow:hidden;}
  .cardx:before{ content:""; position:absolute; inset:-1px;
    background:conic-gradient(from 0deg at 50% 50%, rgba(124,92,255,.14), transparent 30%, rgba(57,255,215,.12), transparent 70%);
    filter: blur(30px); z-index:0; pointer-events:none; opacity:.4; }
  .cardx > *{ position:relative; z-index:1; }
  .section-title{font-weight:1000; letter-spacing:.35px;}
  .muted{color:var(--muted);}

  .band{border:1px solid rgba(140,170,255,.16); border-radius:14px; padding:6px 8px; margin-bottom:8px; background:rgba(9,14,27,.45);}
  .band-head{display:flex; align-items:center; justify-content:space-between; margin-bottom:6px;}
  .grad{height:5px; border-radius:999px; margin:4px 0 6px 0; box-shadow: inset 0 0 6px rgba(0,0,0,.5);}
  .status-pill{font-size:.68rem; padding:.1rem .45rem; border-radius:999px; border:1px solid rgba(140,170,255,.25); color:var(--muted); background:rgba(255,255,255,.03);}
  .chip{ display:inline-flex; align-items:center; justify-content:center; min-width:20px; height:20px; border-radius:6px;
    background:linear-gradient(180deg,var(--chip),var(--chip2)); margin:2px; font-weight:900; color:#d7e6ff;
    border:1px solid rgba(140,170,255,.18); transition:transform .06s ease, box-shadow .12s ease, background .2s ease;
    user-select:none; font-size:.68rem;}
  .chip.euro{background:linear-gradient(180deg,var(--chipE),var(--chipE2));}
  .chip.dim{opacity:.32;} .chip.typing{ box-shadow:0 0 0 2px var(--ok), 0 0 12px var(--ok); animation:pulse .75s ease-in-out infinite; }
  .chip.done{ box-shadow:0 0 0 2px var(--brand), 0 0 12px var(--brand); }
  @keyframes pulse{ 0%{filter:brightness(1)} 50%{filter:brightness(1.4)} 100%{filter:brightness(1)} }
  .neon-progress{height:8px; border-radius:999px; background:rgba(140,170,255,.16); overflow:hidden; box-shadow: inset 0 0 6px rgba(0,0,0,.5);}
  .neon-progress > div{height:100%; width:0%; background: linear-gradient(90deg, var(--brand), var(--accent)); box-shadow:0 0 18px var(--brand); transition: width .25s ease;}

  .sticky-bottom-bar{ position:fixed; left:0; right:0; bottom:0; z-index:1000;
    background:linear-gradient(180deg,rgba(10,16,30,.78),rgba(8,12,24,.95)); border-top:1px solid rgba(140,170,255,.18);
    backdrop-filter: blur(10px);}
  .sticky-bottom-bar .btn{height:56px; font-weight:1000; letter-spacing:.3px; border-width:2px; box-shadow: 0 10px 28px rgba(0,0,0,.35);}

  .live-box{font-family:ui-monospace, Menlo, Consolas, monospace; background:#08101f; border:1px solid rgba(140,170,255,.18); color:#b8ffcc; border-radius:10px; padding:8px; height:140px; overflow:auto;}

  .variant-card{position:relative; border:1px solid rgba(140,170,255,.2); border-radius:14px; padding:10px; margin-bottom:10px; background:linear-gradient(180deg,rgba(10,16,30,.6),rgba(8,12,24,.5));}
  .variant-card:after{content:""; position:absolute; inset:-1px; border-radius:14px; box-shadow:0 0 30px rgba(57,255,215,.12), 0 0 40px rgba(124,92,255,.12); pointer-events:none;}
  .variant-head{display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap;}
  .nums-row{display:flex; flex-wrap:wrap; gap:4px; align-items:center;}
  .badge-soft{background:rgba(140,170,255,.12); border:1px solid rgba(140,170,255,.25); color:#eaf5ff; border-radius:999px; padding:.15rem .5rem; font-size:.72rem;}
  .stat-row{display:flex; gap:8px; flex-wrap:wrap; margin-top:6px;}
  .stat{background:rgba(255,255,255,.03); border:1px solid rgba(140,170,255,.16); border-radius:10px; padding:6px 8px; font-size:.82rem;}
  .stat strong{font-weight:900;}
  .variant-actions{display:flex; gap:6px; margin-top:8px; flex-wrap:wrap;}
  .btn-ghost{--c:rgba(140,170,255,.38); color:#d9e7ff; border:1px solid var(--c); background:rgba(255,255,255,.03);} 
  .btn-ghost:hover{border-color:#7c5cff; box-shadow:0 0 12px rgba(124,92,255,.55) inset;}

  .range-row{display:grid; grid-template-columns: 120px 1fr 60px; gap:8px; align-items:center; margin-bottom:8px;}
  .counter-pill{padding:.15rem .5rem; border-radius:999px; font-weight:1000; font-size:.75rem;}
  .counter-ok{background:rgba(57,255,144,.16); color:#5dffa9; border:1px solid rgba(57,255,144,.38);} 
  .counter-bad{background:rgba(255,107,107,.14); color:#ff9f9f; border:1px solid rgba(255,107,107,.38);}

  .heat-grid{display:grid; grid-template-columns: repeat(10, 1fr); gap:4px;}
  .heat-cell{height:16px; border-radius:4px; text-align:center; font-size:.68rem; line-height:16px; color:#eaf5ff; background:#1a2445;}
  .bar{height:6px; border-radius:999px; background:rgba(140,170,255,.18); overflow:hidden;} .bar > i{display:block; height:100%; width:0%; background:linear-gradient(90deg,#39ffd7,#7c5cff);}

  .overlay{ position:fixed; inset:0; background:rgba(5,8,18,.75); display:none; align-items:center; justify-content:center; z-index:1200; backdrop-filter: blur(6px); }
  .holo{ width:260px; height:260px; border-radius:50%; border:2px solid rgba(124,92,255,.35); box-shadow: inset 0 0 40px rgba(57,255,215,.25), 0 0 40px rgba(124,92,255,.25); animation:spin 2.2s linear infinite; position:relative; }
  .holo:after{ content:"KOMPLEX-ANALYSE"; position:absolute; inset:auto 0 40% 0; text-align:center; color:#cfe8ff; font-weight:1000; letter-spacing:.2em; font-size:.8rem; text-shadow:0 0 12px #7c5cff; }
  @keyframes spin{ from{transform:rotate(0deg)} to{transform:rotate(360deg)} }

  /* --- Extras (Glows, ripple, better chips) --- */
  .btn{ position:relative; overflow:hidden; }
  .btn::after{ content:""; position:absolute; inset:auto -20% -50% -20%; height:140%; background: radial-gradient(circle at 50% 0, rgba(124,92,255,.18), transparent 40%); transform: translateY(100%); transition: transform .35s ease; }
  .btn:hover::after{ transform: translateY(0%); }
  .chip:hover{ transform:translateY(-1px) scale(1.06); box-shadow:0 0 16px rgba(124,92,255,.35); }
  .live-box{ transition: box-shadow .25s ease; }
  .live-box:hover{ box-shadow:0 0 0 1px rgba(124,92,255,.25), 0 10px 24px rgba(0,0,0,.35) inset; }

</style>
</head>
<body>
<div class="container py-3 pb-5">

  <div class="cardx mb-3" id="mapSection">
    <div class="d-flex align-items-center justify-content-between">
      <div class="section-title mb-1">3) Map (1‚Äì50) & Euro (1‚Äì12) ‚Äì extra kompakt</div>
      <div class="small muted" id="progressLabel">Bereit</div>
    </div>
    <div class="neon-progress mb-2"><div id="progressBar"></div></div>
    <div id="bandsMain" class="mb-1"></div>
    <div class="section-title mt-1 mb-1">Eurozahlen</div>
    <div id="bandsEuro"></div>
  </div>

  <div class="row g-3">
    <div class="col-lg-6">
      <div class="cardx">
        <div class="section-title mb-2">1) Archiv</div>
        <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
          <div id="statusText" class="small muted">Noch kein Archiv geladen.</div>
          <input class="form-control form-control-sm" type="file" id="zipInput" accept=".zip,.txt,.csv">
          <button id="loadLatestBtn" class="btn btn-sm btn-primary">üì• Neueste laden</button>
          <button id="clearArchiveBtn" class="btn btn-sm btn-outline-secondary">üßπ Cache l√∂schen</button>
        </div>
        <hr class="text-secondary">
        <div class="row text-center g-2">
          <div class="col-6 col-md-3"><div class="muted small">Ziehungen</div><div id="kpiCount" class="fw-bold">‚Äì</div></div>
          <div class="col-6 col-md-3"><div class="muted small">Von</div><div id="kpiFrom" class="fw-bold">‚Äì</div></div>
          <div class="col-6 col-md-3"><div class="muted small">Bis</div><div id="kpiTo" class="fw-bold">‚Äì</div></div>
          <div class="col-6 col-md-3"><div class="muted small">Aktualit√§t</div><div id="kpiFresh" class="fw-bold">‚Äì</div></div>
        </div>
      </div>

      <div class="cardx mt-3">
        <div class="section-title mb-2">2) Einstellungen</div>
        <div class="mb-2">
          <label class="form-label muted">Anzahl Kombinationen</label>
          <select id="kombis" class="form-select form-select-sm"></select>
        </div>
        <div class="mb-2">
          <label class="form-label muted">Modus</label>
          <select id="modus" class="form-select form-select-sm">
            <option value="never">Nie gezogene</option>
            <option value="last100">Letzte 100 ‚Äì Frequenzmuster</option>
            <option value="hot">Hot Paare & Triples</option>
            <option value="groups">5er-Gruppen + W√ºnsche</option>
            <option value="complex">Komplex (vollst√§ndiger Durchgang)</option>
            <option value="runs">Folgen‚ÄëZahlen (Archiv‚Äësequenzen)</option>
          </select>
        </div>

        <div id="groupSection" style="display:none;">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <div class="muted small">Gruppen: Summe ‚â§ 5 (Rest wird automatisch aufgef√ºllt)</div>
            <div id="mainCounter" class="counter-pill counter-ok">0/‚â§5</div>
          </div>
          <div id="groupControls"></div>

          <hr class="text-secondary">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="toggleEuro">
            <label class="form-check-label" for="toggleEuro">Eurozahlen ber√ºcksichtigen (2 Zahlen)</label>
          </div>
          <div id="euroSection" class="mt-2" style="display:none;">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="muted small">Euro-Summe: 0 oder 2</div>
              <div id="euroCounter" class="counter-pill counter-ok">0/2</div>
            </div>
            <div id="euroControls"></div>
          </div>
        </div>

        <div id="autoEuroNote" class="small text-info" style="display:block;">Eurozahlen werden in diesem Modus automatisch (2) generiert.</div>
      </div>

      <div class="cardx mt-3">
        <div class="section-title mb-2">5) Analyse</div>

        <div class="mb-2">
          <div class="muted small mb-1">Wunsch‚ÄëTipp analysieren</div>
          <div class="row g-1">
            <div class="col-9"><input id="wishMain" class="form-control form-control-sm" placeholder="5 Hauptzahlen (z.‚ÄØB. 1 12 23 34 45)"></div>
            <div class="col-3"><input id="wishEuro" class="form-control form-control-sm" placeholder="Euro (0/2)"></div>
          </div>
          <div class="mt-1 d-flex gap-2 flex-wrap">
            <button class="btn btn-success btn-sm" id="wishAnalyseBtn">Tipp analysieren</button>
            <button class="btn btn-ghost btn-sm" id="wishFromCurrent">Aus letzter Variante</button>
            <button class="btn btn-ghost btn-sm" id="allAnalyseBtn">Alle Varianten analysieren</button>
          </div>
        </div>

        <div id="analysisBox" class="small"></div>
<div class="cardx mt-3" id="favoritesSection">
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-2">
    <div class="section-title mb-0">‚≠ê Favoriten</div>
    <div class="d-flex gap-2 flex-wrap">
      <input id="favSearch" class="form-control form-control-sm" placeholder="Suche ‚Ä¶" style="min-width:180px;">
      <button id="favToggleBtn" class="btn btn-sm btn-secondary">Anzeigen/Verbergen</button>
      <button id="favExportBtn" class="btn btn-sm btn-dark">‚¨áÔ∏è Export</button>
      <button id="favImportBtn" class="btn btn-sm btn-dark">‚¨ÜÔ∏è Import</button>
      <button id="favClearBtn" class="btn btn-sm btn-outline-danger">üóë Leeren</button>
    </div>
  </div>
  <div id="favoritesBox" class="small"></div>
</div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="cardx" id="resultsSection">
        <div class="d-flex align-items-center justify-content-between mb-1">
          <div class="section-title mb-0">4) Generieren</div>
          <div class="muted small" id="progressText">‚Äì</div>
        </div>
        <div id="liveOutput" class="live-box"></div>
        <div id="cards" class="mt-2"></div>
      </div>
    </div>
  </div>
</div>

<div class="sticky-bottom-bar py-2">
  <div class="container">
    <div class="row g-2">
      <div class="col-6"><button id="generateBtn" class="btn btn-dark w-100 border border-2">‚ö° Generieren</button></div>
      <div class="col-6"><button id="analyseBtn" class="btn btn-outline-dark w-100 border border-2">üìà Analysieren</button></div>
    </div>
  </div>
</div>

<div class="overlay" id="overlay"><div class="holo"></div></div>

<script>
/* ---------- Helpers ---------- */
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const sleep = ms => new Promise(r=>setTimeout(r,ms));
function iso(y,m,d){ const dt=new Date(+y, +m-1, +d); return isNaN(dt)? null : dt.toISOString().slice(0,10); }
function shuffle(a){ for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }
function sum(a){ return a.reduce((s,v)=>s+v,0); }
function normalizeVec(v){ const m=Math.max(...v); return v.map(x=> m? x/m : 0); }
function uniqueSorted(a){ return Array.from(new Set(a)).sort((x,y)=>x-y); }
function meanGap(indexes){ if(indexes.length<2) return null; let gaps=[]; for(let i=1;i<indexes.length;i++) gaps.push(indexes[i]-indexes[i-1]); return (gaps.reduce((a,b)=>a+b,0)/gaps.length).toFixed(1); }

/* ---------- State ---------- */
let draws=[]; let freqMain=Array(51).fill(0); let freqEuro=Array(13).fill(0);
let lastSeen=Array(51).fill(null); let lastSeenE=Array(13).fill(null);
let generated=[];

/* ---------- Map ---------- */
const GROUPS=[{label:'1‚Äì10', from:1, to:10, grad:'var(--g1)'},{label:'11‚Äì20', from:11, to:20, grad:'var(--g2)'},{label:'21‚Äì30', from:21, to:30, grad:'var(--g3)'},{label:'31‚Äì40', from:31, to:40, grad:'var(--g4)'},{label:'41‚Äì50', from:41, to:50, grad:'var(--g5)'}];
const EGROUPS=[{label:'1‚Äì6', from:1, to:6, grad:'var(--e1)'},{label:'7‚Äì12', from:7, to:12, grad:'var(--e2)'}];

function buildBands(container, groups, euro=false){
  container.innerHTML='';
  groups.forEach(g=>{
    const band=document.createElement('div'); band.className='band';
    const head=document.createElement('div'); head.className='band-head';
    const status=document.createElement('span'); status.className='status-pill'; status.textContent='GESCHLOSSEN';
    head.innerHTML=`<div class="fw-bold">${g.label}</div>`; head.appendChild(status);
    const grad=document.createElement('div'); grad.className='grad'; grad.style.background=g.grad;
    const row=document.createElement('div');
    for(let n=g.from;n<=g.to;n++){ const chip=document.createElement('div'); chip.className='chip'+(euro?' euro':''); chip.textContent=n; chip.dataset.num=n; row.appendChild(chip); }
    band.appendChild(head); band.appendChild(grad); band.appendChild(row);
    container.appendChild(band);
  });
}
buildBands($('#bandsMain'), GROUPS, false);
buildBands($('#bandsEuro'), EGROUPS, true);

/* ---------- Controls ---------- */
for(let i=1;i<=25;i++){ const o=document.createElement('option'); o.value=i; o.textContent=i; $('#kombis').appendChild(o); }

function buildGroupControls(){
  const host=$('#groupControls'); host.innerHTML='';
  GROUPS.forEach((g,idx)=>{
    const row=document.createElement('div'); row.className='range-row';
    const lab=document.createElement('div'); lab.innerHTML=`<div class="fw-bold">${g.label}</div>`;
    const sel=document.createElement('select'); sel.className='form-select form-select-sm'; sel.dataset.idx=idx;
    for(let v=0;v<=5;v++){ const o=document.createElement('option'); o.value=v; o.textContent=v; sel.appendChild(o); }
    sel.addEventListener('change', ()=>{updateCounters(); updateBandStatus();});
    const hint=document.createElement('div'); hint.className='text-end muted'; hint.textContent='0';
    row.appendChild(lab); row.appendChild(sel); row.appendChild(hint); host.appendChild(row);
  });
}
function buildEuroControls(){
  const host=$('#euroControls'); host.innerHTML='';
  EGROUPS.forEach((g,idx)=>{
    const row=document.createElement('div'); row.className='range-row';
    const lab=document.createElement('div'); lab.innerHTML=`<div class="fw-bold">${g.label}</div>`;
    const sel=document.createElement('select'); sel.className='form-select form-select-sm euro-sel'; sel.dataset.idx=idx;
    for(let v=0;v<=2;v++){ const o=document.createElement('option'); o.value=v; o.textContent=v; sel.appendChild(o); }
    sel.addEventListener('change', ()=>{updateCounters(); updateBandStatus();});
    const hint=document.createElement('div'); hint.className='text-end muted'; hint.textContent='0';
    row.appendChild(lab); row.appendChild(sel); row.appendChild(hint); host.appendChild(row);
  });
}
buildGroupControls(); buildEuroControls();

function setModeUI(){
  const mode = $('#modus').value;
  const groupsOn = (mode==='groups');
  $('#groupSection').style.display = groupsOn ? '' : 'none';
  $('#autoEuroNote').style.display = groupsOn ? 'none' : 'block';
  if(!groupsOn){ $('#toggleEuro').checked=false; $('#euroSection').style.display='none'; }
  updateCounters(); updateBandStatus();
}
$('#modus').addEventListener('change', setModeUI);
$('#toggleEuro').addEventListener('change', e=>{ $('#euroSection').style.display = e.target.checked ? '' : 'none'; updateCounters(); updateBandStatus(); });

function updateCounters(){
  let sumG=0;
  $$('#groupControls select').forEach(sel=>{ const v=+sel.value||0; sumG+=v; sel.parentElement.lastChild.textContent=v; });
  const mc=$('#mainCounter'); if(mc){ mc.textContent=sumG+'/‚â§5'; mc.className='counter-pill ' + (sumG<=5?'counter-ok':'counter-bad'); }
  let esum=0;
  if($('#toggleEuro').checked){
    $$('#euroControls select').forEach(sel=>{ const v=+sel.value||0; esum+=v; sel.parentElement.lastChild.textContent=v; });
  }
  const ec=$('#euroCounter'); if(ec){ ec.textContent=esum+'/2'; ec.className='counter-pill '+((esum===0||esum===2)?'counter-ok':'counter-bad'); }
}
function updateBandStatus(){
  const counts = $$('#groupControls select').map(s=>+s.value||0);
  GROUPS.forEach((g,i)=>{
    const band = Array.from($('#bandsMain').children)[i];
    const pill = band.querySelector('.status-pill');
    pill.textContent = counts[i]===0 ? 'GESCHLOSSEN' : 'OFFEN ('+counts[i]+')';
  });
  if($('#toggleEuro').checked){
    const ecounts = $$('#euroControls select').map(s=>+s.value||0);
    EGROUPS.forEach((g,i)=>{
      const band = Array.from($('#bandsEuro').children)[i];
      const pill = band.querySelector('.status-pill');
      pill.textContent = ecounts[i]===0 ? 'GESCHLOSSEN' : 'OFFEN ('+ecounts[i]+')';
    });
  }else{
    EGROUPS.forEach((g,i)=>{ const band = Array.from($('#bandsEuro').children)[i]; band.querySelector('.status-pill').textContent='GESCHLOSSEN'; });
  }
}

/* ---------- Archiv Laden ---------- */
document.getElementById('zipInput').addEventListener('change', handleFile);
async function handleFile(evt){
  const file = evt.target.files?.[0]; if(!file) return;
  $('#statusText').textContent='Lade‚Ä¶'; draws=[]; freqMain.fill(0); freqEuro.fill(0); lastSeen.fill(null); lastSeenE.fill(null);
  try{
    let text='';
    if(file.name.toLowerCase().endsWith('.zip')){
      const zip = await JSZip.loadAsync(file);
      const entries = Object.values(zip.files);
      let entry = entries.find(f=>/\.(txt|csv)$/i.test(f.name) && /eurojackpot/i.test(f.name)) || entries.find(f=>/\.(txt|csv)$/i.test(f.name));
      if(!entry) throw new Error('ZIP ohne TXT/CSV.');
      text = await entry.async('string');
    }else{ text = await file.text(); }
    parseArchiveText(text);
  }catch(e){ $('#statusText').textContent='Fehler: '+e.message; }
}
function parseArchiveText(txt){
  txt = txt.replace(/^\uFEFF/, '');
  const lines = txt.replace(/\r\n?/g,'\n').split('\n').map(l=>l.trim()).filter(Boolean);
  const regDMY=/^(\d{1,2})[.\-/](\d{1,2})[.\-/](\d{2,4})$/; const regYMD=/^(\d{4})[.\-/](\d{1,2})[.\-/](\d{1,2})$/;
  function parseLine(line){
    const t=line.split(/;|,|\t|\s+/).filter(Boolean); let date=null,rest=[];
    if(t.length>=1){
      if(regDMY.test(t[0])){const m=t[0].match(regDMY); date=iso(m[3],m[2],m[1]); rest=t.slice(1);}
      else if(regYMD.test(t[0])){const m=t[0].match(regYMD); date=iso(m[1],m[2],m[3]); rest=t.slice(1);}
      else if(t.length>=3 && /^\d+$/.test(t[0]) && /^\d+$/.test(t[1]) && /^\d+$/.test(t[2])){date=iso(t[2],t[1],t[0]); rest=t.slice(3);}
      else rest=t.slice();
    }
    const nums=rest.map(Number).filter(n=>!Number.isNaN(n));
    if(!date && nums.length>=3){const [a,b,c]=nums; const d=iso(c,b,a); if(d) date=d;}
    const main=nums.filter(n=>n>=1&&n<=50).slice(0,5).sort((a,b)=>a-b);
    const euro=nums.filter(n=>n>=1&&n<=12).slice(0,2).sort((a,b)=>a-b);
    if(!date||main.length!==5||euro.length!==2) return null;
    return {date, main, euro};
  }
  draws=[];
  for(const l of lines){const r=parseLine(l); if(r){draws.push(r);}}
  if(!draws.length){ $('#statusText').textContent='Keine g√ºltigen Ziehungen erkannt.'; return; }
  draws.sort((a,b)=>a.date.localeCompare(b.date));
  draws.forEach((d,idx)=>{
    d.main.forEach(n=>{ freqMain[n]++; lastSeen[n]=idx; });
    d.euro.forEach(n=>{ freqEuro[n]++; lastSeenE[n]=idx; });
  });
  $('#kpiCount').textContent=String(draws.length);
  $('#kpiFrom').textContent=draws[0].date;
  $('#kpiTo').textContent=draws[draws.length-1].date;
  const lastDate=new Date(draws[draws.length-1].date); const deltaDays=Math.round((Date.now()-lastDate.getTime())/86400000);
  $('#kpiFresh').textContent=(deltaDays<=14)?'aktuell':'veraltet';
  $('#statusText').textContent='Archiv geladen ‚úî';
  renderAnalysis();
}

/* ---------- Analyse (Heat) ---------- */
function renderAnalysis(){
  if(!draws.length){ $('#analysisBox').innerHTML='<div class="muted">Bitte Archiv laden.</div>'; return; }
  const fm=[...freqMain], fe=[...freqEuro];
  const maxM=Math.max(...fm.slice(1)), maxE=Math.max(...fe.slice(1));
  let html='<div class="mb-1"><strong>Hauptzahlen (1‚Äì50) ‚Äì H√§ufigkeit</strong></div><div class="heat-grid">';
  for(let n=1;n<=50;n++){ const p=Math.round((fm[n]/(maxM||1))*100); html+=`<div class="heat-cell">${n}<div class="bar"><i style="width:${p}%"></i></div></div>`; }
  html+='</div><div class="mt-2 mb-1"><strong>Eurozahlen (1‚Äì12) ‚Äì H√§ufigkeit</strong></div><div class="heat-grid" style="grid-template-columns: repeat(12,1fr);">';
  for(let n=1;n<=12;n++){ const p=Math.round((fe[n]/(maxE||1))*100); html+=`<div class="heat-cell">${n}<div class="bar"><i style="width:${p}%"></i></div></div>`; }
  html+='</div>';
  $('#analysisBox').innerHTML = html;
}

/* ---------- Analyse einer Variante (verbessert) ---------- */
function exactOccurrences(tip){
  const idx=[]; for(let i=0;i<draws.length;i++){ const d=draws[i];
    if(tip.main.length===5 && d.main.length===5 && tip.main.every((n,j)=>n===d.main[j])) idx.push(i);
  } return idx;
}
function analyseVariant(tip){
  const idx=exactOccurrences(tip);
  const occurCount=idx.length;
  const last = occurCount? draws[idx.at(-1)].date : 'nie';
  const avgGap = occurCount? meanGap(idx) : '‚Äì';
  const first = occurCount? draws[idx[0]].date : '‚Äì';
  const dist = Array(8).fill(0);
  for(const d of draws){ const ov = tip.main.filter(x=>d.main.includes(x)).length + tip.euro.filter(x=>d.euro.includes(x)).length; dist[ov]++; }
  const ov3p = dist.slice(3).reduce((a,b)=>a+b,0);
  const freqSum = tip.main.reduce((s,n)=>s+freqMain[n],0);
  return {occurCount,last,first,avgGap,dist,ov3p,freqSum};
}
function variantCard(idx, tip){
  const a = analyseVariant(tip);
  const card=document.createElement('div'); card.className='variant-card';
  const head=document.createElement('div'); head.className='variant-head';
  const nums=document.createElement('div'); nums.className='nums-row';
  tip.main.forEach(n=>{ const c=document.createElement('div'); c.className='chip'; c.textContent=n; nums.appendChild(c); });
  if(tip.euro.length){ const sep=document.createElement('span'); sep.className='badge-soft'; sep.textContent='Euro'; nums.appendChild(sep);
    tip.euro.forEach(n=>{ const c=document.createElement('div'); c.className='chip euro'; c.textContent=n; nums.appendChild(c); }); }
  const tag=document.createElement('span'); tag.className='badge-soft'; tag.textContent='#'+idx;
  head.appendChild(nums); head.appendChild(tag); card.appendChild(head);
  const stats=document.createElement('div'); stats.className='stat-row';
  stats.innerHTML=`
    <div class="stat">Vorkommen (exakt): <strong>${a.occurCount}</strong></div>
    <div class="stat">Erstes: <strong>${a.first}</strong></div>
    <div class="stat">Letztes: <strong>${a.last}</strong></div>
    <div class="stat">√ò Abstand (Ziehungen): <strong>${a.avgGap}</strong></div>
    <div class="stat">Overlap ‚â•3: <strong>${a.ov3p}</strong></div>
    <div class="stat">FreqSum: <strong>${a.freqSum}</strong></div>`;
  card.appendChild(stats);
  const actions=document.createElement('div'); actions.className='variant-actions';
  const btnMap=document.createElement('button'); btnMap.className='btn btn-ghost btn-sm'; btnMap.textContent='üëÅ Map'; btnMap.onclick=()=>{ $('#mapSection').scrollIntoView({behavior:'smooth'}); liveType(tip, idx, generated.length); };
  const btnAna=document.createElement('button'); btnAna.className='btn btn-success btn-sm'; btnAna.textContent='üìä Detailanalyse'; btnAna.onclick=()=>renderTipAnalysis(tip,true);
  actions.appendChild(btnMap); actions.appendChild(btnAna); card.appendChild(actions);
  return card;
}
function renderTipAnalysis(tip, prepend=false){
  const a = analyseVariant(tip);
  const distRows = a.dist.map((v,i)=> `<tr><td>${i}</td><td>${v}</td></tr>`).join('');
  const tipStr = tip.main.join('-') + (tip.euro.length? ' | E:'+tip.euro.join('-') : '');
  const html = `
    <div class="mt-2">
      <div><strong>Detailanalyse:</strong> ${tipStr}</div>
      <div class="row g-2 mt-1">
        <div class="col-6"><div class="small muted">Overlap-Verteilung</div>
          <div class="table-responsive"><table class="table table-dark table-sm"><thead><tr><th>Treffer</th><th>Anzahl Ziehungen</th></tr></thead><tbody>${distRows}</tbody></table></div>
        </div>
        <div class="col-6"><div class="small muted">Kennzahlen</div>
          <ul class="small">
            <li>Vorkommen (exakt): <strong>${a.occurCount}</strong></li>
            <li>Erstes/Letztes: <strong>${a.first}</strong> ‚Üí <strong>${a.last}</strong></li>
            <li>√ò Abstand (Ziehungen): <strong>${a.avgGap}</strong></li>
            <li>Overlap ‚â•3: <strong>${a.ov3p}</strong></li>
            <li>Frequenzsumme Hauptzahlen: <strong>${a.freqSum}</strong></li>
            <li>Archiv-Ziehungen: <strong>${draws.length}</strong></li>
          </ul>
        </div>
      </div>
    </div>`;
  const box = document.createElement('div'); box.innerHTML = html;
  if(prepend){ $('#analysisBox').prepend(box); } else { $('#analysisBox').appendChild(box); }
  box.scrollIntoView({behavior:'smooth', block:'nearest'});
}
function analyseAllGenerated(){
  if(!generated.length){ alert('Noch keine Varianten generiert.'); return; }
  const fG=Array(51).fill(0), fGE=Array(13).fill(0);
  generated.forEach(t=>{ t.main.forEach(n=>fG[n]++); t.euro.forEach(e=>fGE[e]++); });
  const top = [...Array(51).keys()].slice(1).map(n=>[n,fG[n]]).sort((a,b)=>b[1]-a[1]).slice(0,10);
  const topE = [...Array(13).keys()].slice(1).map(n=>[n,fGE[n]]).sort((a,b)=>b[1]-a[1]).slice(0,5);
  const dist=Array(8).fill(0);
  generated.forEach(t=>{ for(const d of draws){ const ov = t.main.filter(x=>d.main.includes(x)).length + t.euro.filter(x=>d.euro.includes(x)).length; dist[ov]++; } });
  const list = (arr)=>arr.map(([k,v])=>`<span class="badge text-bg-dark me-1 mb-1">${k} <small class="text-muted">(${v})</small></span>`).join('');
  const table = dist.map((v,i)=>`<tr><td>${i}</td><td>${v}</td></tr>`).join('');
  const html = `<div class="mt-3"><div><strong>Gesamt‚ÄëAnalyse der ${generated.length} Varianten</strong></div>
    <div class="row g-2 mt-1">
      <div class="col-6"><div class="small muted">Top Zahlen (generiert)</div><div class="mt-1">${list(top)}</div>
        <div class="mt-2 small muted">Top Euro</div><div class="mt-1">${list(topE)}</div></div>
      <div class="col-6"><div class="small muted">Overlap-Verteilung (alle Varianten √ó Archiv)</div>
        <div class="table-responsive"><table class="table table-dark table-sm"><thead><tr><th>Treffer</th><th>Anzahl</th></tr></thead><tbody>${table}</tbody></table></div></div>
    </div></div>`;
  const box = document.createElement('div'); box.innerHTML = html; $('#analysisBox').appendChild(box); box.scrollIntoView({behavior:'smooth'});
}
document.getElementById('allAnalyseBtn').addEventListener('click', analyseAllGenerated);

/* ---------- Wunsch-Analyse Buttons ---------- */
document.getElementById('wishAnalyseBtn').addEventListener('click', ()=>{
  const m = $('#wishMain').value.trim().split(/\s+|,|;|-/).map(Number).filter(n=>n>=1&&n<=50);
  const e = $('#wishEuro').value.trim()? $('#wishEuro').value.trim().split(/\s+|,|;|-/).map(Number).filter(n=>n>=1&&n<=12) : [];
  if(m.length!==5){ alert('Bitte genau 5 Hauptzahlen (1‚Äì50) eingeben.'); return; }
  if(!(e.length===0 || e.length===2)){ alert('Euro: 0 oder 2 Zahlen (1‚Äì12).'); return; }
  renderTipAnalysis({main:uniqueSorted(m).slice(0,5), euro:uniqueSorted(e).slice(0,2)}, true);
});
document.getElementById('wishFromCurrent').addEventListener('click', ()=>{
  if(!generated.length){ alert('Noch keine Variante generiert.'); return; }
  const t = generated[generated.length-1]; $('#wishMain').value = t.main.join(' '); $('#wishEuro').value = t.euro.join(' ');
  $('#analysisBox').scrollIntoView({behavior:'smooth', block:'start'});
});

/* ---------- Generator Bausteine ---------- */
function pickFromRange(from,to,avoid,count,weightFn){
  const bag=[]; for(let n=from;n<=to;n++){ if(!avoid.includes(n)){ const w=Math.max(1, weightFn?weightFn(n):1); for(let k=0;k<w;k++) bag.push(n);} }
  shuffle(bag);
  const res=[]; for(const v of bag){ if(!res.includes(v)){ res.push(v); if(res.length===count) break; } }
  return res;
}
function euroAuto(){
  const fe=freqEuro.slice(); const maxE=Math.max(...fe.slice(1))||1;
  const lastIdx=draws.length-1;
  const w = (e)=>{
    const f = fe[e]/maxE;
    const gap = lastSeenE[e]!=null ? (lastIdx-lastSeenE[e]) : lastIdx+1;
    const gapN = Math.min(1, gap/(lastIdx+1));
    return 1 + Math.round(3*(0.55*f + 0.45*gapN));
  };
  const e = pickFromRange(1,12,[],2,w).sort((a,b)=>a-b);
  return e;
}

/* ---------- Komplex (vollst√§ndiger Durchgang) ‚Äì Simulated Annealing ---------- */
function buildMatrices(){
  const C = Array.from({length:51}, ()=>Array(51).fill(0));
  const recentW = Math.min(150, draws.length);
  const recentStart = draws.length - recentW;
  const recentF = Array(51).fill(0);
  for(let i=0;i<draws.length;i++){
    const d=draws[i]; const m=d.main;
    for(let a=0;a<m.length;a++) for(let b=a+1;b<m.length;b++){ C[m[a]][m[b]]++; C[m[b]][m[a]]++; }
    if(i>=recentStart){ m.forEach(x=>recentF[x]++); }
  }
  const fNorm = normalizeVec(freqMain);
  const trendNorm = normalizeVec(recentF);
  const gaps = lastSeen.map(ix => ix==null ? draws.length : (draws.length-1-ix));
  const gapNorm = normalizeVec(gaps);
  const pairScore = (i,j)=>{
    const fij=C[i][j]; if(fij===0) return 0;
    const denom = (freqMain[i]||1)*(freqMain[j]||1);
    return fij/denom;
  };
  return {pairScore, fNorm, trendNorm, gapNorm};
}
function scoreSet(set, mats){
  const {pairScore,fNorm,trendNorm,gapNorm} = mats;
  const wF=0.32, wT=0.30, wR=0.38, wPair=0.75, wBal=0.25;
  const base = set.reduce((s,n)=> s + (wF*fNorm[n] + wT*trendNorm[n] + wR*gapNorm[n]), 0);
  let p=0; for(let i=0;i<set.length;i++) for(let j=i+1;j<set.length;j++){ p += pairScore(set[i],set[j]); }
  const target=[1,1,1,1,1]; const counts=[0,0,0,0,0];
  set.forEach(n=>{ const g = Math.floor((n-1)/10); counts[g]++; });
  const balPenalty = counts.reduce((s,c,i)=> s + Math.abs(c-target[i]), 0);
  const balScore = Math.max(0, 5 - balPenalty)/5;
  return base + wPair*p + wBal*balScore;
}
function complexSimulatedAnnealing(){
  const mats = buildMatrices();
  const w = n=> 1 + Math.round(5*(mats.trendNorm[n]*0.6 + mats.gapNorm[n]*0.4));
  let current = pickFromRange(1,50,[],5,w).sort((a,b)=>a-b);
  let best = current.slice();
  let currentScore = scoreSet(current, mats);
  let bestScore = currentScore;
  const ITER = 1600 + Math.floor(Math.random()*600);
  for(let t=0;t<ITER;t++){
    const T = 1 - t/ITER;
    const c = current.slice();
    const k = (Math.random()<T? 2:1);
    for(let i=0;i<k;i++){
      const rmIdx = Math.floor(Math.random()*c.length);
      const avoid = c.slice(); avoid.splice(rmIdx,1);
      const add = pickFromRange(1,50,avoid,1,w);
      if(add.length){ c[rmIdx]=add[0]; }
      c.sort((a,b)=>a-b);
    }
    const s = scoreSet(c, mats);
    const accept = (s>currentScore) || (Math.random()<Math.exp((s-currentScore)/(0.15+0.0001)));
    if(accept){ current=c; currentScore=s; if(s>bestScore){ best=c; bestScore=s; } }
  }
  return {main:best, euro:euroAuto()};
}

/* ---------- Folgen-Zahlen (Runs) ---------- */
function runsBest(){
  const runMap=new Map();
  function inc(key){ runMap.set(key,(runMap.get(key)||0)+1); }
  for(const d of draws){
    const m=[...d.main].sort((a,b)=>a-b);
    let seq=[m[0]];
    for(let i=1;i<m.length;i++){
      if(m[i]===m[i-1]+1){ seq.push(m[i]); }
      else{
        if(seq.length>=2){ for(let L=2; L<=Math.min(4,seq.length); L++){ for(let s=0;s+L<=seq.length;s++){ inc(seq.slice(s,s+L).join('-')); } } }
        seq=[m[i]];
      }
    }
    if(seq.length>=2){ for(let L=2; L<=Math.min(4,seq.length); L++){ for(let s=0;s+L<=seq.length;s++){ inc(seq.slice(s,s+L).join('-')); } } }
  }
  const lastIdx = draws.length-1;
  const scoreEntries=[];
  for(const [k,v] of runMap.entries()){
    const nums=k.split('-').map(Number);
    const lastSeenMin = Math.min(...nums.map(n=> lastSeen[n]==null? -1 : lastSeen[n]));
    const gap = lastSeenMin<0? lastIdx+1 : (lastIdx-lastSeenMin);
    const fresh = 1 + gap/(lastIdx+1);
    scoreEntries.push([nums, v*fresh]);
  }
  scoreEntries.sort((a,b)=>b[1]-a[1]);
  const pick = scoreEntries.slice(0,50);
  const base = pick.length? pick[Math.floor(Math.random()*Math.min(12,pick.length))][0] : [];
  let main = uniqueSorted(base);
  while(main.length<5){
    const add = pickFromRange(1,50,main,1, n=> (freqMain[n]? freqMain[n]:1) + (lastSeen[n]==null?3:0) );
    if(add.length) main.push(add[0]); else break;
  }
  main = uniqueSorted(main).slice(0,5);
  return {main, euro:euroAuto()};
}

/* ---------- Generator pro Modus ---------- */
function generateOne(){
  const mode = $('#modus').value;
  let main=[];
  if(mode==='groups'){
    const wish = $$('#groupControls select').map(s=>+s.value||0);
    let sumWish = sum(wish);
    if(sumWish>5) throw new Error('Gruppen-Summe darf max. 5 sein.');
    let weightMain=null;
    if(draws.length){
      const r=draws.slice(-100); const fm=Array(51).fill(1); r.forEach(d=>d.main.forEach(n=>fm[n]++));
      const maxM=Math.max(...fm.slice(1)); weightMain=n=>Math.ceil(3*fm[n]/maxM);
    }
    GROUPS.forEach((g,i)=>{ const need=wish[i]; if(need>0){ main.push(...pickFromRange(g.from,g.to,main,need,weightMain)); } });
    if(main.length<5){
      const openRanges = GROUPS.filter((g,i)=>wish[i]>0);
      if(openRanges.length){
        while(main.length<5){
          const g = openRanges[Math.floor(Math.random()*openRanges.length)];
          const add = pickFromRange(g.from,g.to,main,1,weightMain);
          if(add.length) main.push(add[0]); else break;
        }
      }else{
        main = pickFromRange(1,50,[],5,weightMain);
      }
    }
    main = uniqueSorted(main).slice(0,5);
    let euro=[];
    if($('#toggleEuro').checked){
      const ecounts = $$('#euroControls select').map(s=>+s.value||0);
      const esum = ecounts.reduce((a,b)=>a+b,0);
      if(!(esum===0 || esum===2)) throw new Error('Euro-Summe muss 0 oder 2 sein.');
      if(esum===2){ EGROUPS.forEach((g,i)=>{ const need=ecounts[i]; if(need>0){ euro.push(...pickFromRange(g.from,g.to,euro,need,null)); } }); euro.sort((a,b)=>a-b); }
    }
    return {main, euro};
  }
  else if(mode==='last100' && draws.length){
    const r=draws.slice(-100); const fm=Array(51).fill(1); r.forEach(d=>d.main.forEach(n=>fm[n]++));
    const maxM=Math.max(...fm.slice(1)); const w=n=>Math.ceil(3*fm[n]/maxM);
    main = pickFromRange(1,50,[],5,w).sort((a,b)=>a-b);
    return {main, euro:euroAuto()};
  }
  else if(mode==='never' && draws.length){
    const fm=freqMain.slice(); const w=n=> fm[n]===0?5:(fm[n]<=5?3:1);
    main = pickFromRange(1,50,[],5,w).sort((a,b)=>a-b);
    return {main, euro:euroAuto()};
  }
  else if(mode==='hot' && draws.length){
    const recent = draws.slice(-200);
    const pairMap=new Map(); const tripleMap=new Map();
    function inc(map,key){ map.set(key,(map.get(key)||0)+1); }
    for(const d of recent){
      const m=[...d.main].sort((a,b)=>a-b);
      for(let i=0;i<m.length;i++) for(let j=i+1;j<m.length;j++){ inc(pairMap, `${m[i]}-${m[j]}`); }
      for(let i=0;i<m.length;i++) for(let j=i+1;j<m.length;j++) for(let k=j+1;k<m.length;k++){ inc(tripleMap, `${m[i]}-${m[j]}-${m[k]}`); }
    }
    const topPairs=[...pairMap.entries()].sort((a,b)=>b[1]-a[1]).slice(0,30).map(e=>e[0].split('-').map(Number));
    const topTrip=[...tripleMap.entries()].sort((a,b)=>b[1]-a[1]).slice(0,20).map(e=>e[0].split('-').map(Number));
    if(Math.random()<0.5 && topTrip.length){ main = [...topTrip[Math.floor(Math.random()*topTrip.length)]]; }
    else if(topPairs.length){ main = [...topPairs[Math.floor(Math.random()*topPairs.length)]]; }
    const r=draws.slice(-100); const fm=Array(51).fill(1); r.forEach(d=>d.main.forEach(n=>fm[n]++));
    const maxM=Math.max(...fm.slice(1)); const w=n=>Math.ceil(2*fm[n]/maxM);
    while(main.length<5){ const add = pickFromRange(1,50,main,1,w); if(add.length) main.push(add[0]); else break; }
    main.sort((a,b)=>a-b);
    return {main, euro:euroAuto()};
  }
  else if(mode==='complex' && draws.length){
    $('#overlay').style.display='flex';
    const tip = complexSimulatedAnnealing();
    $('#overlay').style.display='none';
    return tip;
  }
  else if(mode==='runs' && draws.length){
    return runsBest();
  }
  else{
    main = pickFromRange(1,50,[],5,null).sort((a,b)=>a-b);
    return {main, euro:euroAuto()};
  }
}

/* ---------- Live Map ---------- */
function clearMapMarks(){ $$('#bandsMain .chip, #bandsEuro .chip').forEach(c=>c.classList.remove('dim','typing','done')); $$('#bandsMain .chip, #bandsEuro .chip').forEach(c=>c.classList.add('dim')); }
async function liveType(tip, index, total){
  clearMapMarks();
  const pb = $('#progressBar'); const pl = $('#progressLabel');
  const mode = $('#modus').value;
  const delay = (mode==='complex')? 160 : 110;
  for(const n of tip.main){ const el = document.querySelector(`#bandsMain .chip[data-num="${n}"]`); if(el){ el.classList.remove('dim'); el.classList.add('typing'); await sleep(delay); el.classList.remove('typing'); el.classList.add('done'); } }
  for(const n of tip.euro){ const el = document.querySelector(`#bandsEuro .chip[data-num="${n}"]`); if(el){ el.classList.remove('dim'); el.classList.add('typing'); await sleep(delay); el.classList.remove('typing'); el.classList.add('done'); } }
  $('#progressText').textContent = `Variante #${index} / ${total}`; pb.style.width = Math.round(index/total*100)+'%'; pl.textContent = `#${index}/${total}`;
}

/* ---------- Ergebnisse ---------- */
function renderResults(){
  const cards = $('#cards'); cards.innerHTML='';
  generated.forEach((tip, i)=>{ cards.appendChild(variantCard(i+1, tip)); });
}

/* ---------- Buttons ---------- */
document.getElementById('generateBtn').addEventListener('click', async ()=>{
  setModeUI();
  $('#mapSection').scrollIntoView({behavior:'smooth', block:'start'});
  const total = +$('#kombis').value || 1;
  const out = $('#liveOutput'); out.textContent='';
  $('#progressText').textContent='Start‚Ä¶'; $('#progressBar').style.width='0%'; $('#progressLabel').textContent='Start‚Ä¶';
  generated=[];
  const seen = new Set();
  for(let i=1;i<=total;i++){
    try{
      let tip = generateOne();
      let key = tip.main.join('-');
      let guard=0;
      while(seen.has(key) && guard<10){ tip = generateOne(); key = tip.main.join('-'); guard++; }
      seen.add(key);
      generated.push(tip);
      out.textContent += '#'+i+': '+ tip.main.join('-') + (tip.euro.length? ' | E:'+tip.euro.join('-'):'') + '\n';
      await liveType(tip, i, total);
      renderResults();
      out.scrollTop = out.scrollHeight;
    }catch(e){ out.textContent += 'FEHLER: '+e.message+'\n'; break; }
  }
});
document.getElementById('analyseBtn').addEventListener('click', ()=>{ $('#analysisBox').scrollIntoView({behavior:'smooth', block:'start'}); });

/* ---------- Init ---------- */
function init(){
  $$('#bandsMain .chip, #bandsEuro .chip').forEach(c=>c.classList.add('dim'));
  setModeUI();
}
init();
</script>
</body>
</html>
